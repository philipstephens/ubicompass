<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Content Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
        iframe { width: 100%; height: 600px; border: 1px solid #ccc; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Chart Content Test</h1>
    <div id="test-results"></div>
    
    <h2>Chart Preview</h2>
    <iframe id="chart-iframe" src="/decile-calculator-svg-demo.html"></iframe>
    
    <script>
        const resultsDiv = document.getElementById('test-results');
        const iframe = document.getElementById('chart-iframe');
        
        function addResult(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            resultsDiv.appendChild(div);
        }
        
        iframe.addEventListener('load', () => {
            addResult('✅ Chart iframe loaded successfully');
            
            setTimeout(() => {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    
                    // Check for income chart
                    const incomeChart = iframeDoc.getElementById('incomeChart');
                    if (incomeChart) {
                        addResult('✅ Income chart SVG element found');
                        
                        // Count rectangles (bars)
                        const rects = incomeChart.querySelectorAll('rect');
                        addResult(`✅ Found ${rects.length} rectangles in income chart`);
                        
                        // Check for our new CSS classes
                        const afterTaxNewBars = incomeChart.querySelectorAll('.after-tax-new-bar');
                        const afterTaxOldBars = incomeChart.querySelectorAll('.after-tax-old-bar');
                        const ubiBars = incomeChart.querySelectorAll('.ubi-bar');
                        const incomeBars = incomeChart.querySelectorAll('.income-bar');
                        
                        addResult(`✅ Found ${afterTaxNewBars.length} after-tax-new bars`);
                        addResult(`✅ Found ${afterTaxOldBars.length} after-tax-old bars`);
                        addResult(`✅ Found ${ubiBars.length} UBI bars`);
                        addResult(`✅ Found ${incomeBars.length} income bars`);
                        
                        // Check if we have the expected number of bars (should be 30 total for 10 deciles × 3 bars each)
                        const expectedBars = 30; // 10 deciles × 3 bars each
                        if (rects.length >= expectedBars) {
                            addResult(`✅ Expected number of bars found (${rects.length} >= ${expectedBars})`);
                        } else {
                            addResult(`⚠️ Fewer bars than expected (${rects.length} < ${expectedBars})`, 'warning');
                        }
                        
                        // Check legend
                        const legendItems = iframeDoc.querySelectorAll('.legend-item');
                        addResult(`✅ Found ${legendItems.length} legend items`);
                        
                        // Check for specific legend text
                        const legendTexts = Array.from(legendItems).map(item => item.textContent);
                        if (legendTexts.some(text => text.includes('Before-Tax Income'))) {
                            addResult('✅ "Before-Tax Income" legend found');
                        } else {
                            addResult('❌ "Before-Tax Income" legend NOT found', 'error');
                        }
                        
                        if (legendTexts.some(text => text.includes('After-Tax Income (New)'))) {
                            addResult('✅ "After-Tax Income (New)" legend found');
                        } else {
                            addResult('❌ "After-Tax Income (New)" legend NOT found', 'error');
                        }
                        
                    } else {
                        addResult('❌ Income chart SVG element NOT found', 'error');
                    }
                    
                } catch (e) {
                    addResult(`❌ Error accessing iframe content: ${e.message}`, 'error');
                }
            }, 2000); // Wait 2 seconds for chart to render
        });
        
        iframe.addEventListener('error', () => {
            addResult('❌ Chart iframe failed to load', 'error');
        });
    </script>
</body>
</html>
