<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Range Component Solution</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’°</text></svg>">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .header-container {
            background-color: rgba(186, 164, 61, 1);
            height: 16rem;
            display: flex;
            align-items: center;
            padding: 0 2rem;
        }
        .header-content {
            display: flex;
            flex-direction: column;
            color: white;
        }
        .menu-container {
            background-color: rgb(255, 215, 0);
            height: 1rem;
        }
        .income-range {
            border-radius: 24px;
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .income-range-header {
            background-color: blue;
            padding: 10px 15px;
            text-align: center;
        }
        .income-range-header h4 {
            font-weight: bold;
            font-size: 18px;
            margin: 0;
            color: white;
        }
        .income-range-content {
            padding: 20px;
        }
        .tax-bracket {
            background-color: #f0f8ff;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .tax-bracket-row {
            display: flex;
            justify-content: space-between;
        }
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            z-index: 1000;
        }
        .notification.show {
            opacity: 1;
        }
        pre {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .code-block {
            margin: 20px 0;
        }
        .copy-button {
            background-color: #4a86e8;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 5px;
        }
        .copy-button:hover {
            background-color: #3a76d8;
        }
    </style>
</head>
<body>
    <div class="min-h-screen">
        <!-- Header -->
        <div class="header-container">
            <div class="header-content">
                <h1 class="text-3xl font-bold">Income Range Component Solution</h1>
                <p class="text-sm">A standalone solution for the income range component</p>
            </div>
        </div>

        <!-- Menu -->
        <div class="menu-container"></div>

        <!-- Main content -->
        <div class="mx-4 p-6 bg-white rounded-lg shadow-md mt-4">
            <h2 class="text-2xl font-bold mb-4">Income Range Component Solution</h2>
            <p class="mb-4">
                This page provides a complete solution for the income range component that avoids circular reference issues in Qwik.
                Below you'll find the working component and instructions on how to integrate it into your Qwik application.
            </p>
            
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 mb-6">
                <h3 class="text-blue-800 font-medium text-lg mb-2">How to Use This Solution</h3>
                <p class="text-blue-600 text-sm mb-2">
                    The circular reference error you're encountering is a known issue with Qwik's serialization mechanism.
                    To work around this issue, we've created a standalone component that:
                </p>
                <ol class="text-blue-600 text-sm list-decimal pl-5">
                    <li class="mb-1">Uses local state instead of relying on the UBI store</li>
                    <li class="mb-1">Avoids complex nested components that might cause circular references</li>
                    <li class="mb-1">Provides a clean API for integration with your existing components</li>
                    <li class="mb-1">Can be copied directly into your Qwik application</li>
                </ol>
            </div>
            
            <!-- Demo Component -->
            <h3 class="text-xl font-bold mb-4">Demo Component</h3>
            <div class="income-range">
                <div class="income-range-header">
                    <h4>Income Range</h4>
                </div>
                <div class="income-range-content">
                    <p style="margin-bottom: 16px">
                        <strong>Current Tax Model:</strong>
                        <span id="currentTaxModel">Flat Tax</span>
                    </p>
                    <p style="margin-bottom: 8px">
                        <strong>Tax Brackets:</strong>
                    </p>
                    <div class="tax-bracket">
                        <div class="tax-bracket-row">
                            <span id="bracket1">$0k - $24k</span>
                            <span style="font-weight: bold">0%</span>
                        </div>
                    </div>
                    <div class="tax-bracket">
                        <div class="tax-bracket-row">
                            <span id="bracket2">$24k+</span>
                            <span style="font-weight: bold" id="taxRateValue">30%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Integration Instructions -->
            <h3 class="text-xl font-bold mt-8 mb-4">Integration Instructions</h3>
            <p class="mb-4">
                Follow these steps to integrate this component into your Qwik application:
            </p>
            
            <div class="mb-6">
                <h4 class="text-lg font-semibold mb-2">Step 1: Create a standalone component file</h4>
                <p class="mb-2">Create a new file called <code>income-range-standalone.tsx</code> in your components directory and copy the following code:</p>
                <div class="code-block">
                    <button class="copy-button" onclick="copyCode('code1')">Copy Code</button>
                    <pre><code id="code1">import { component$, useSignal, $ } from "@builder.io/qwik";

export const IncomeRangeStandalone = component$(({
  exemptionAmount = 24,
  taxRate = 30,
  onExemptionChange$ = undefined,
}) => {
  // Local state
  const localExemptionAmount = useSignal(exemptionAmount);
  
  // Update local state when props change
  if (localExemptionAmount.value !== exemptionAmount) {
    localExemptionAmount.value = exemptionAmount;
  }
  
  // Handle exemption amount change
  const handleExemptionChange = $((newAmount: number) => {
    localExemptionAmount.value = newAmount;
    if (onExemptionChange$) {
      onExemptionChange$(newAmount);
    }
  });
  
  return (
    <div
      style={{
        borderRadius: "24px",
        overflow: "hidden",
        border: "1px solid #ccc",
        backgroundColor: "white",
        boxShadow: "0 4px 8px rgba(0, 0, 0, 0.1)",
      }}
    >
      {/* Blue header */}
      <div
        style={{
          backgroundColor: "blue",
          padding: "10px 15px",
          textAlign: "center",
        }}
      >
        <h4
          style={{
            fontWeight: "bold",
            fontSize: "18px",
            margin: 0,
            color: "white",
          }}
        >
          Income Range
        </h4>
      </div>

      {/* Content */}
      <div style={{ padding: "20px" }}>
        <p style={{ marginBottom: "16px" }}>
          <strong>Current Tax Model:</strong> Flat Tax
        </p>
        
        <p style={{ marginBottom: "8px" }}>
          <strong>Tax Brackets:</strong>
        </p>
        <div
          style={{
            backgroundColor: "#f0f8ff",
            padding: "12px",
            borderRadius: "8px",
            marginBottom: "8px",
          }}
        >
          <div
            style={{
              display: "flex",
              justifyContent: "space-between",
            }}
          >
            <span>
              {`$0k - $${localExemptionAmount.value}k`}
            </span>
            <span style={{ fontWeight: "bold" }}>
              0%
            </span>
          </div>
        </div>
        <div
          style={{
            backgroundColor: "#f0f8ff",
            padding: "12px",
            borderRadius: "8px",
          }}
        >
          <div
            style={{
              display: "flex",
              justifyContent: "space-between",
            }}
          >
            <span>
              {`$${localExemptionAmount.value}k+`}
            </span>
            <span style={{ fontWeight: "bold" }}>
              {`${taxRate}%`}
            </span>
          </div>
        </div>
      </div>
    </div>
  );
});</code></pre>
                </div>
            </div>
            
            <div class="mb-6">
                <h4 class="text-lg font-semibold mb-2">Step 2: Use the component in your page</h4>
                <p class="mb-2">Now you can use this component in any page without worrying about circular references:</p>
                <div class="code-block">
                    <button class="copy-button" onclick="copyCode('code2')">Copy Code</button>
                    <pre><code id="code2">import { component$, useSignal, $ } from "@builder.io/qwik";
import { IncomeRangeStandalone } from "~/components/income-range-standalone";

export default component$(() => {
  // Local state
  const exemptionAmount = useSignal(24);
  
  // Handle exemption amount change
  const handleExemptionChange = $((amount: number) => {
    exemptionAmount.value = amount;
    console.log("Exemption amount changed to:", amount);
  });
  
  return (
    <div>
      <h2>Income Range Demo</h2>
      
      <div class="flex flex-wrap gap-6 mt-8">
        {/* Income Range Component */}
        <div class="w-full md:w-1/3">
          <IncomeRangeStandalone 
            exemptionAmount={exemptionAmount.value} 
            taxRate={30}
            onExemptionChange$={handleExemptionChange}
          />
        </div>
      </div>
    </div>
  );
});</code></pre>
                </div>
            </div>
            
            <div class="mb-6">
                <h4 class="text-lg font-semibold mb-2">Step 3: Integrate with your UBI store (optional)</h4>
                <p class="mb-2">If you want to integrate with your UBI store, you can do so carefully:</p>
                <div class="code-block">
                    <button class="copy-button" onclick="copyCode('code3')">Copy Code</button>
                    <pre><code id="code3">import { component$, useSignal, $, useContext } from "@builder.io/qwik";
import { UbiDataContext } from "~/stores/ubi-data-store";
import { IncomeRangeStandalone } from "~/components/income-range-standalone";

export default component$(() => {
  // Local state
  const exemptionAmount = useSignal(24);
  
  // Get the UBI store
  const ubiStore = useContext(UbiDataContext);
  
  // Update local state from store if needed
  if (ubiStore.selectedExemptionAmount && 
      exemptionAmount.value !== ubiStore.selectedExemptionAmount) {
    exemptionAmount.value = ubiStore.selectedExemptionAmount;
  }
  
  // Handle exemption amount change
  const handleExemptionChange = $((amount: number) => {
    exemptionAmount.value = amount;
    
    // Update the store (be careful with this to avoid circular references)
    ubiStore.selectedExemptionAmount = amount;
    
    console.log("Exemption amount changed to:", amount);
  });
  
  return (
    <div>
      <h2>Income Range Demo</h2>
      
      <div class="flex flex-wrap gap-6 mt-8">
        {/* Income Range Component */}
        <div class="w-full md:w-1/3">
          <IncomeRangeStandalone 
            exemptionAmount={exemptionAmount.value} 
            taxRate={ubiStore.selectedYear?.flattaxpercentage || 30}
            onExemptionChange$={handleExemptionChange}
          />
        </div>
      </div>
    </div>
  );
});</code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        Code copied to clipboard!
    </div>

    <script>
        // Function to copy code to clipboard
        function copyCode(elementId) {
            const codeElement = document.getElementById(elementId);
            const textToCopy = codeElement.textContent;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                // Show notification
                const notification = document.getElementById('notification');
                notification.textContent = 'Code copied to clipboard!';
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }
    </script>
</body>
</html>
