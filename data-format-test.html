<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Format Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .code { background: #e9ecef; padding: 10px; border-radius: 3px; font-family: monospace; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>Data Format Test</h1>
    
    <div class="test">
        <h3>Testing Fallback Data Format</h3>
        <div id="fallback-test"></div>
    </div>
    
    <div class="test">
        <h3>Testing Chart with Simple Data</h3>
        <svg id="test-chart" width="800" height="400" style="border: 1px solid #ccc;"></svg>
    </div>
    
    <script>
        // Test the fallback data format
        function getFallbackData(year) {
            console.log(`Using fallback data for ${year}`);
            return [
                { decile: 1, lowerBound: 0, upperBound: 15000, averageTaxableIncome: 8500, label: "Lowest 10%" },
                { decile: 2, lowerBound: 15000, upperBound: 25000, averageTaxableIncome: 20000, label: "10-20%" },
                { decile: 3, lowerBound: 25000, upperBound: 35000, averageTaxableIncome: 30000, label: "20-30%" },
                { decile: 4, lowerBound: 35000, upperBound: 45000, averageTaxableIncome: 40000, label: "30-40%" },
                { decile: 5, lowerBound: 45000, upperBound: 55000, averageTaxableIncome: 50000, label: "40-50%" },
                { decile: 6, lowerBound: 55000, upperBound: 70000, averageTaxableIncome: 62500, label: "50-60%" },
                { decile: 7, lowerBound: 70000, upperBound: 85000, averageTaxableIncome: 77500, label: "60-70%" },
                { decile: 8, lowerBound: 85000, upperBound: 105000, averageTaxableIncome: 95000, label: "70-80%" },
                { decile: 9, lowerBound: 105000, upperBound: 150000, averageTaxableIncome: 125000, label: "80-90%" },
                { decile: 10, lowerBound: 150000, upperBound: 500000, averageTaxableIncome: 250000, label: "Highest 10%" }
            ];
        }
        
        const testData = getFallbackData(2022);
        const fallbackTestDiv = document.getElementById('fallback-test');
        
        fallbackTestDiv.innerHTML = `
            <div class="code">Raw data sample:</div>
            <div class="code">Decile 1: averageTaxableIncome = ${testData[0].averageTaxableIncome} (this is $${testData[0].averageTaxableIncome})</div>
            <div class="code">Decile 5: averageTaxableIncome = ${testData[4].averageTaxableIncome} (this is $${testData[4].averageTaxableIncome})</div>
            <div class="code">Decile 10: averageTaxableIncome = ${testData[9].averageTaxableIncome} (this is $${testData[9].averageTaxableIncome})</div>
            <br>
            <div class="code">If we divide by 1000 to convert to thousands:</div>
            <div class="code">Decile 1: ${testData[0].averageTaxableIncome / 1000}k</div>
            <div class="code">Decile 5: ${testData[4].averageTaxableIncome / 1000}k</div>
            <div class="code">Decile 10: ${testData[9].averageTaxableIncome / 1000}k</div>
            <br>
            <div class="code">These look reasonable! So the data IS in dollars and we DO need to divide by 1000.</div>
        `;
        
        // Test simple chart creation
        const svg = document.getElementById('test-chart');
        
        // Create a simple test chart
        function createTestChart() {
            svg.innerHTML = '';
            
            // Create basic structure
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            g.setAttribute('transform', 'translate(50, 50)');
            svg.appendChild(g);
            
            // Draw axes
            const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            xAxis.setAttribute('x1', 0);
            xAxis.setAttribute('y1', 300);
            xAxis.setAttribute('x2', 700);
            xAxis.setAttribute('y2', 300);
            xAxis.setAttribute('stroke', '#666');
            g.appendChild(xAxis);
            
            const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            yAxis.setAttribute('x1', 0);
            yAxis.setAttribute('y1', 0);
            yAxis.setAttribute('x2', 0);
            yAxis.setAttribute('y2', 300);
            yAxis.setAttribute('stroke', '#666');
            g.appendChild(yAxis);
            
            // Draw simple bars for the data
            const maxIncome = Math.max(...testData.map(d => d.averageTaxableIncome / 1000));
            const yScale = 300 / maxIncome;
            const barWidth = 60;
            const barSpacing = 70;
            
            testData.forEach((entry, index) => {
                const income = entry.averageTaxableIncome / 1000; // Convert to thousands
                const height = income * yScale;
                const x = index * barSpacing + 10;
                const y = 300 - height;
                
                // Create bar
                const bar = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                bar.setAttribute('x', x);
                bar.setAttribute('y', y);
                bar.setAttribute('width', barWidth);
                bar.setAttribute('height', height);
                bar.setAttribute('fill', '#2196f3');
                bar.setAttribute('stroke', '#1976d2');
                g.appendChild(bar);
                
                // Add label
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', x + barWidth/2);
                label.setAttribute('y', y - 5);
                label.setAttribute('text-anchor', 'middle');
                label.setAttribute('font-size', '12px');
                label.textContent = `$${Math.round(income)}k`;
                g.appendChild(label);
                
                // Add decile label
                const decileLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                decileLabel.setAttribute('x', x + barWidth/2);
                decileLabel.setAttribute('y', 320);
                decileLabel.setAttribute('text-anchor', 'middle');
                decileLabel.setAttribute('font-size', '12px');
                decileLabel.textContent = `D${entry.decile}`;
                g.appendChild(decileLabel);
            });
            
            // Add Y-axis labels
            for (let i = 0; i <= 5; i++) {
                const value = (i * maxIncome) / 5;
                const y = 300 - (i * 300) / 5;
                
                const yLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                yLabel.setAttribute('x', -10);
                yLabel.setAttribute('y', y + 5);
                yLabel.setAttribute('text-anchor', 'end');
                yLabel.setAttribute('font-size', '12px');
                yLabel.textContent = `$${Math.round(value)}k`;
                g.appendChild(yLabel);
            }
        }
        
        createTestChart();
    </script>
</body>
</html>
